<!DOCTYPE html>{% load static %}{% load app_filters %}
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<title>Achtelbass</title>
	<style>

        body {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
            background: #fff;
            color: #111;
        }

        main {
            overflow: hidden;
            margin: 0 auto;
            max-width: 2000px;
        }

        #abc {
            display: none;
        }

        form {
            overflow: hidden;
            background: url('{% static "images/bg_texture___wood_by_nortago.jpg" %}') top left #402107;
            box-shadow: -5px -5px 5px #210 inset;
            padding-bottom: 3em;
        }

        form > fieldset *:not(input),
        form h2 {
            color: #f2ecdc;
        }

        form h2 {
            margin-top: 1em;
            margin-bottom: 0.5em;
            text-shadow: 2px 2px 2px #333;
        }

	.controls {
            float: left;
            border: 0;
            padding: 1em;
        }

        @media (min-width: 1200px) {
            form {
                float: left;
                width: 300px;
            }

            #canvas {
                float: right;
            }
        }

        @media (min-width: 1300px) {
            form {
                width: 400px;
            }
        }

        @media (min-width: 1500px) {
            form {
                width: 600px;
            }
        }

        @media (min-width: 1700px) {
            form {
                width: 800px;
            }
        }
    
        @media (min-width: 1900px) {
            form {
                width: 1000px;
            }
        }

        .controls input[type="checkbox"],
	.controls input[type="radio"] {
		display: none;
	}

        .controls input[type="checkbox"] + label,
        .controls input[type="radio"] + label,
        .controls input[type="submit"] {
            line-height: 2em;
            padding: 0 0.5em;
            border-radius: 0.5em;
            color: #888;
            background-color: #f2ecdc;
            display: inline-block;
            margin-bottom: 1em;
            text-align: center;
            cursor: pointer;
            box-shadow: -3px -3px 3px #ccc inset;
            border: none;
        }

        .controls input:checked + label,
        .controls input[type="submit"]:active {
            color: #111;
            background: #ad9968;
            box-shadow: 3px 3px 3px #888 inset;
        }

        .controls input[type="submit"] {
            color: #111;
            font-weight: bold;
            margin-top: 1em;
            font-size: 1.2em;
        }

		label[for="note_values_1_2"] {
			background: green;
		}

		.note_values label {
            padding: 0 !important;
            height: 2em;
            width: 2em;
		}
        
        .note_values label img {
            width: 60%;
            height: 60%;
            margin: 20%;
		}

		.pitch_container {
            clear: left;
            float: left;
            padding: 1em;
			overflow: hidden;
		}

		.pitch_container fieldset {
			float: left;
			color: #111;
			margin: 0;
			padding: 0;
			background: #fff;
		}

            .pitch_container fieldset:first-of-type {
				position: relative;
			}

            .pitch_container fieldset:first-of-type:before {
				content: '.';
				color: #fff;
				opacity: 0.4;
				z-index: 5;
				position: absolute;
				top: 1.3em;
				left: 0.2em;
				height: 7.4em;
				width: 3em;
				background: url('{% static "images/violin.svg" %}') bottom left no-repeat;
				background-size: auto 100%;
			}

            .pitch_container fieldset:first-of-type:after {
				content: '.';
				color: #fff;
				opacity: 0.4;
				z-index: 5;
				position: absolute;
				bottom: 4.8em;
				left: 0.2em;
				height: 2.6em;
				width: 3em;
				background: url('{% static "images/bass.svg" %}') bottom left no-repeat;
				background-size: auto 100%;
			}

            .pitch_container fieldset:last-of-type {
				padding-right: 1px;
			}

				.pitch_container fieldset:first-of-type p {
					padding-left: 9em;
				}

				.pitch_container fieldset:last-of-type p {
					padding-right: 4em;
				}

            .pitch_container p {
                margin: 0;
                font-size: 9px;
                height: 1em;
                position: relative;
                overflow: visible;
            }

            .pitch_container p:first-child {
				padding: 0 0.5em;
				text-align: right;
			}

			.pitch_container p.max_pitch,
            .pitch_container p.max_pitch ~ p {
				background: #ad9968;
			}

            .pitch_container p.max_pitch ~ p.min_pitch + p ~ p {
				background: #fff;
			}

			.pitch_container p.min_pitch,
            .pitch_container p.min_pitch ~ p {
				background: #ad9968;
			}

            .pitch_container p.min_pitch ~ p.max_pitch + p ~ p {
				background: #fff;
			}

            .pitch_container p.regular_line:nth-of-type(even) {
                border-bottom: 1px solid #111;
             }

            .pitch_container p.ledger_line:nth-of-type(even) {
                border-bottom: 1px solid #ccc;
             }

            .pitch_container p:first-of-type {
				border-bottom: none;
			}

			.pitch_container fieldset:last-of-type p.regular_line {
				border-right: 1px solid #111;
			}

			.pitch_container fieldset:last-of-type p.ledger_line + p.regular_line {
				border-right: none;
			}

            .pitch_container .controls input[type="radio"] {
                font-size: 9px;
                display: inline-block;
                margin: 0;
                height: 1em;
                opacity: 0;
                z-index: 0;
            }

            .pitch_container .controls input[type="radio"] + label {
                background: none;
                padding: 0;
                line-height: 2em;
                width: 1.7em;
                height: 1.7em;
                text-shadow: none;
                margin: 0;
                box-shadow: none;
                position: absolute;
                top: 0.15em;
                left: 7em;
                border-radius: 2em;
                transition: background-color 0.5s;
                z-index: 2;
				overflow: visible;
            }

            .pitch_container fieldset.controls:last-of-type input[type="radio"] + label {
				left: 1em;
			}

            .pitch_container .controls input[type="radio"] + label:hover {
				background: #888;
			}

            .pitch_container .controls input[type="radio"]:checked + label {
                background: #111;
            }

			.pitch_container p.ledger_line:nth-of-type(odd) input[type="radio"]:checked + label:before {
				content: '.';
				border-top: 2px solid #111;
				width: 2.3em;
				margin-left: -0.3em;
				text-align: center;
				display: block;
				margin-top: 0.8em;
			}

        label[for="chords_frequency"],
        label[for="rest_frequency"] {
            min-width: 3em;
            display: inline-block;
            text-align: right;
        }
    </style>
	<meta name="viewport" content="width=device-width, initial-scale=1" />	
    <!--http://nortago.deviantart.com/art/Bg-Texture-wood-38841113 Wood-Background by nortago, thanks a lot!-->
</head>
<body>
{{ debugging_info }}
<!--applet id="MIDIPlugin" code="MIDIPlugin.class" name="MIDIPlugin" archive="http://dl.dropbox.com/u/223827/abcjs/MIDIPlugin.jar" height="1" width="1"></applet-->

<textarea id="abc">
{{ generated_notes }}
</textarea>
<div id="warnings"></div>
<!--button id="triggerRender">Run</button-->

{# TODO Prevent via javascript selecting smaller pitch range than greatest interval #}
{# TODO Prevent via javascript selecting greater interval than smallest pitch range #}

<main>
    <form id="configure" action="." method="post">{% csrf_token %}
        <fieldset class="controls intervals">
            <h2>{{ Locales.Intervals }}</h2>
            {% for interval_index, interval_name in Possible_Intervals.items %}
                <input type="checkbox" id="interval_{{ interval_name }}" name="intervals" value="{{ interval_name }}"{% if interval_name in preselected.intervals %} checked="checked"{% endif %} />
                <label for="interval_{{ interval_name }}">{{ interval_name }}</label>
            {% endfor %}
        </fieldset>
        <fieldset class="controls note_values">
            <h2>{{ Locales.note_values }} {{ note_values_symbol_entities.1 }} </h2>
            {% for note_value in Possible_Note_Values %}
                <input type="checkbox" id="{{ note_value_names|get_key:note_value }}" name="note_values" value="{{ note_value }}"{% if note_value in preselected.note_values %} checked="checked"{% endif %} />
                <label for="{{ note_value_names|get_key:note_value }}">
                <img src="{% static note_value_names|get_note_file_location:note_value  %}">
                </label>
            {% endfor %}
        </fieldset>
        {# commented out while only triplets are supported #}
        {% if 1 == 0 %}<!--<fieldset class="controls tuplets">
            <h2>{{ Locales.Tuplets }} </h2>
            {% for tuplet in Possible_Tuplets %}
                <input type="checkbox" id="tuplets_{{ tuplet }}" name="tuplets" value="{{ tuplet }}"{% if tuplet in preselected.tuplets %} checked="checked"{% endif %} />
                <label for="tuplets_{{ tuplet }}">{{ tuplet }}</label>
            {% endfor %}
        </fieldset> -->{% endif %}

		<div class="pitch_container">
            <h2>Pitch</h2>
            <fieldset class="controls min_pitch">
                {% for note_object in Note_Objects %}
                    <p class="{{ note_object.line_type }}{% ifequal note_object.note preselected.min_pitch %} min_pitch{% endifequal %}{% ifequal note_object.note preselected.max_pitch %} max_pitch{% endifequal %}">
                        <input type="radio" id="min_pitch_{{ note_object.note }}" name="min_pitch" value="{{ note_object.note }}"{% ifequal note_object.note preselected.min_pitch %} checked="checked"{% endifequal %} />
                        <label title="{{ note_object.note }}" for="min_pitch_{{ note_object.note }}"></label>
                    </p>
                {% endfor %}
            </fieldset>
            <fieldset class="controls max_pitch">
                {% for note_object in Note_Objects %}
                    <p class="{{ note_object.line_type }}{% ifequal note_object.note preselected.min_pitch %} min_pitch{% endifequal %}{% ifequal note_object.note preselected.max_pitch %} max_pitch{% endifequal %}">
                        <input type="radio" id="max_pitch_{{ note_object.note }}" name="max_pitch" value="{{ note_object.note }}"{% ifequal note_object.note preselected.max_pitch %} checked="checked"{% endifequal %} />
                        <label title="{{ note_object.note }}" for="max_pitch_{{ note_object.note }}"></label>
                    </p>
                {% endfor %}
            </fieldset>
        </div>


        <fieldset class="controls time_signature">
            <h2>{{ Locales.time_signature }}</h2>
            {% for time_signature in Possible_Time_Signatures %}
                <input type="radio" id="time_signature_{{ time_signature }}" name="time_signature" value="{{ time_signature }}"{% ifequal time_signature preselected.time_signature %} checked="checked"{% endifequal %} />
                <label for="time_signature_{{ time_signature }}">{{ time_signature }}</label>
            {% endfor %}
        </fieldset>
        <fieldset class="controls mode">
            <h2>{{ Locales.Mode }}</h2>
            {% for mode in Modes %}
                <input type="radio" id="mode_{{ mode }}" name="mode" value="{{ mode }}"{% ifequal mode preselected.mode %} checked="checked"{% endifequal %} />
                <label for="mode_{{ mode }}">{{ mode }}</label>
            {% endfor %}
        </fieldset>
        <fieldset class="controls grand_staff">
            <h2>Grand Staff</h2>
            <input type="checkbox" id="grand_staff_{{ grand_staff }}" name="grand_staff" value="1"{% if preselected.grand_staff %} checked="checked"{% endif %} />
            <label for="grand_staff_{{ grand_staff }}">Grand Staff</label>
        </fieldset>
		<div style="float: left;">
			<fieldset class="controls chords">
				<h2>{{ Locales.Chords }}</h2>
				<input type="range" min="0" max="1" step="0.01" name="chords_frequency" id="chords_frequency" value="{{ preselected.chords_frequency }}" />
				<label for="chords_frequency">{{ preselected.chords_frequency }}%</label>
			</fieldset>
			<fieldset class="controls rests">
				<h2>{{ Locales.Rests }}</h2>
				<input type="range" min="0" max="1" step="0.01" name="rest_frequency" id="rest_frequency" value="{{ preselected.rest_frequency }}" />
				<label for="rest_frequency">{{ preselected.rest_frequency }}%</label>
			</fieldset>
			<fieldset class="controls tuplets">
				<h2>{{ Locales.Triplets }}</h2>
				<input type="hidden" id="tuplets_3" name="tuplets" value="3"/> {# for the time being only triplets are supported #}
				<input type="range" min="0" max="1" step="0.01" name="tuplets_frequency" id="tuplets_frequency" value="{{ preselected.tuplets_frequency }}" />
				<label for="tuplets_frequency">{{ preselected.tuplets_frequency }}%</label>
			</fieldset>
		</div>
        <fieldset class="controls tonic">
            <h2>{{ Locales.Tonic }}</h2>
            {% for tonic in Tonics %}
                <input type="radio" id="tonic_{{ tonic }}" name="tonic" value="{{ tonic }}"{% ifequal tonic preselected.tonic %} checked="checked"{% endifequal %} />
                <label for="tonic_{{ tonic }}">{{ tonic }}</label>
            {% endfor %}
        </fieldset>
    </form>
    <div id="midi"></div>
    <div id="canvas"></div>
</main>
<script src="{% static 'abcjs/bin/abcjs_basic_latest-min.js' %}" type="text/javascript"></script>
<script type="text/javascript">
	var configure 	= document.getElementById('configure');

	var submit_configure = function() {
					console.log('submit');
		configure.submit();
	}

    ABCJS.renderAbc("canvas", document.getElementById("abc").value);
    //ABCJS.renderMidi("midi", document.getElementById("abc").value);

	if (document.querySelectorAll('fieldset input[type="range"]').length) {
		Array.prototype.forEach.call(document.querySelectorAll('fieldset:not(.pitch) input[type="range"]'), function(el, i) {
			if (typeof(el.nextElementSibling) !== "undefined") {
				el.nextElementSibling.textContent = parseInt(el.value * 100) + '%';
				el.addEventListener('input', function() {
					el.nextElementSibling.textContent = parseInt(el.value * 100) + '%';
				});
			}
		});
	}
    		
	Array.prototype.forEach.call(configure.querySelectorAll('fieldset input'), function(el, i) {
		el.addEventListener('change', submit_configure);
	});

	</script>
</body>
</html>
